<html lang="en">
<head>
<meta charset="utf-8">
<title>Image</title>

<script src="http://localhost:3031/socket.io/socket.io.js"></script>

<link rel="stylesheet" type="text/css" href="style.css" />
</head>
<body>
  
<script>	
console.log("Count = "+JSON.stringify(ipAddr));
console.log("Canvas = "+ipAddr['10.0.0.48']);
/* var curLine = new Array(v),newLine= new Array(v); */
//newLine = 0; //Remove This
var curLine = new Object();

for(var key in ipAddr)
	curLine[key] = 0;

			
(function()
 {
	 var supportsCanvas = !!document.createElement('canvas').getContext;
	 supportsCanvas && (window.onload = overlay());
		
	 function overlay()
	 {
		 var scon = false;
		 var socket = io.connect('http://localhost:3031');
	
		 socket.on('connect', function () 
		 {
			 //alert('Socket is connected.');
			 $("#loaderSub").html("<pre>Monitoring Started.....</pre>");
			 scon = true;
		 });
		 
		 socket.on('disconnect',function(){
			$("#loaderSub").html("<pre>Monitoring Server Disconnected...</pre>"); 
		 });
	
		 socket.on('UpdatePrint',function(data)
		 {
			 console.log(data.Data);
			 d = data.Data.toString().split(":");
			 colorLines(curLine[d[0]],d[1],ipAddr[d[0]]);
			 curLine[d[0]] = d[1];
		 });
		 
		 socket.on('FIN',function(data)
		 {
			 console.log(data.Data);
			 colorLines(curLine[d[0]],"FIN",ipAddr[d[0]]);
		 });
		 		/* v+=2; */
				for(i=0;i<=v;i++)
				{
					var canvas = document.getElementById("mcanvas"+i);
					if(canvas != undefined)
					{
						var ctx = canvas.getContext('2d');
						ctx.rect(0,0,canvas.width,canvas.height);
			
						var grd = ctx.createLinearGradient(0,0,canvas.width,canvas.height);
						//light blue
						grd.addColorStop(0,'#3A539B');
						// dark blue
						grd.addColorStop(1,'#2C3E50');
						ctx.fillStyle = grd;
						ctx.fill();
					}
				}
			}
	})();
	
	function colorLines(curLine,newLine,i)
		{
		
		var canvas = document.getElementById("mcanvas"+i);
		
			if(newLine == "FIN")
				newLine = canvas.height;
				
			curLine = parseInt(curLine);
			newLine = parseInt(newLine);
			
			
			ctx = canvas.getContext("2d");
			var imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
			var px = imageData.data;
			
			if(newLine == "FIN")
				newLine = canvas.height;
			
			if(newLine > canvas.height)
				newLine = canvas.height;
			
			if(curLine < newLine ){
			for(i=canvas.width*4*(curLine -1);i<canvas.width*4*newLine;i++)
				px[i+3] = 0;
				
				console.log("Updated from "+curLine+" to Line: "+newLine);
			}
			else
				console.log("Not Updated from "+curLine+" to Line: "+newLine);	
			/* newLine++; //Remove This */
			ctx.putImageData(imageData,0,0);
		}
		
	</script>
	<!-- <button onclick=colorLines()>ColorLine</button> -->	
	<script type="text/javascript" src="jquery.js"></script>
</body>
</html>