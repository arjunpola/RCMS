<html lang="en">
<head>
<meta charset="utf-8">
<title>Image</title>

<style type="text/css">
#mcanvas{
position:absolute;
top:0px;
left:0px;
opacity:0.8;
}

#cvs-src{
position:relative;
top:0;
left:0;
}

.img-wrap{
position:relative;
top: 0;
left: 0;
}

</style>

<script src="http://localhost:3000/socket.io/socket.io.js"></script>
	<script>
	var socket = io.connect('http://localhost:3000');
	
	socket.on('PrintStatus',function(data){
		console.log(data['update']);
		newLine = data['update'];
		if(curLine == newLine)
			console.log("Dont Update");
		else{
			console.log("Update Image");
			colorLines();
		}
	});
	
	socket.emit('PrintStatus',{id:"myID"});
	
	//socket.emit("otherEvent",{data:"myData"});
	
</script>

</head>
<body>
	<div class="img-wrap">
	<img id = "cvs-src" width="500" height="500" src="Pola.jpg" />
	<canvas id="mcanvas" width="500" height="500"></canvas>
	</div>
	
	<script>
	
	var canvas = document.getElementById("mcanvas");
	var ctx = canvas.getContext('2d');
	ctx.rect(0,0,canvas.width,canvas.height);
			var curLine = 0,newLine=0;
			

			
	(function(){
		var supportsCanvas = !!document.createElement('canvas').getContext;
		supportsCanvas && (window.onload = overlay());

		function overlay()
		{
			var grd = ctx.createLinearGradient(0,0,canvas.width,canvas.height);
			//light blue
			grd.addColorStop(0,'#3A539B');
			// dark blue
			grd.addColorStop(1,'#2C3E50');
			ctx.fillStyle = grd;
			ctx.fill();
								
		}
	})();
	
	function colorLines()
		{
			var imageData = ctx.getImageData(0,0,500,500);
			var px = imageData.data;
			if(curLine<500)
			for(i=500*curLine*4;i<500*4*newLine;i++){
				px[i+3] = 0;
			}
			curLine = newLine;
			ctx.putImageData(imageData,0,0);
		}
	</script>
<button onclick="colorLines()">Color Line</button>
</body>
</html>